---
title: "Solicitudes de Acceso a la Información Pública 2015"
author: "Patricio del Boca"
date: "July 8, 2016"
output: html_document
---
```{r, echo=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
```

## Introducción

La intención es jugar un poco con los datos publicados en el [Portal de Datos Abiertos de la Nacion](http://datos.gob.ar). Especificamente el dataset "Solicitudes de Acceso a la Información Pública 2015" mientras pruebo algunas modificaciones en el theme de ggplot inspirado por este post.

Algunas preguntas que se me vienen en mente son:

 - ¿Quiénes piden información?
 - ¿Sobre qué temas en particular?
 - ¿Qué tan eficiente fue el estado para respoder?
 - ¿Qué cantidad de solicitudes se generan?

```{r}
library(ggplot2)
library(dplyr)
library(lubridate)
library(ggthemes)
library(riverplot)
```

### Obtención de datos y Limpieza de Datos
```{r}
df <- read.csv("http://datos.gob.ar/dataset/8bc053c8-efc2-485d-97d3-915c476d2741/resource/63952097-cdba-4fdd-be84-65fb400bdb1a/download/acceso-informacion-publica.csv")

df$fecha_de_la_respuesta3 <- dmy(df$fecha_de_la_respuesta)

df$fecha_de_recepcion_de_la_solicitud_por_el_enlace <- dmy(
  df$fecha_de_recepcion_de_la_solicitud_por_el_enlace)

df$fecha_de_recepcion_de_la_solicitud_por_el_organismo <- dmy(
  df$fecha_de_recepcion_de_la_solicitud_por_el_organismo)

df$plazo_en_el_que_se_contesto_la_solicitud <- tolower(
  df$plazo_en_el_que_se_contesto_la_solicitud
)

df$plazo_en_el_que_se_contesto_la_solicitud <- gsub(
  "en el plazo de 20 días",
  "10-20 días",
  df$plazo_en_el_que_se_contesto_la_solicitud
)

df$plazo_en_el_que_se_contesto_la_solicitud <- gsub(
  "se contestó, pero luego de los 20 días",
  "20+ días",
  df$plazo_en_el_que_se_contesto_la_solicitud
)

df$plazo_en_el_que_se_contesto_la_solicitud <- gsub(
  "30 días",
  "20+ días",
  df$plazo_en_el_que_se_contesto_la_solicitud
)

df$plazo_en_el_que_se_contesto_la_solicitud <- gsub(
  "en el plazo de 10 días",
  "0-10 días",
  df$plazo_en_el_que_se_contesto_la_solicitud
)

df$plazo_en_el_que_se_contesto_la_solicitud <- gsub(
  "en el plazo máximo de 20 días",
  "10-20 días",
  df$plazo_en_el_que_se_contesto_la_solicitud
)

df$plazo_en_el_que_se_contesto_la_solicitud <- gsub(
  "en el plazo máximo de 20 días",
  "10-20 días",
  df$plazo_en_el_que_se_contesto_la_solicitud
)

df$plazo_en_el_que_se_contesto_la_solicitud <- ifelse(
  df$plazo_en_el_que_se_contesto_la_solicitud == "",
  "Pedientes/Derivadas/Devueltas",
  df$plazo_en_el_que_se_contesto_la_solicitud
)

df$plazo_en_el_que_se_contesto_la_solicitud <- factor(
  df$plazo_en_el_que_se_contesto_la_solicitud,
  levels=c("0-10 días","10-20 días", "20+ días", "aún no se contestó", "Pedientes/Derivadas/Devueltas")
)

df$perfil_del_solicitante <- tolower(df$perfil_del_solicitante)
df$perfil_del_solicitante <- as.factor(df$perfil_del_solicitante)
```

### Funciones Auxiliares
```{r}
tabla_contingencia <- function(data = df, column = column){
  tabla <- df %>%
      select_(column) %>% 
      group_by_(var = column) %>% 
      summarise(cantidad = n()) %>% 
      mutate(porcentaje = paste0(round(cantidad / sum(cantidad) * 100,1),"%"))
  tabla
}

grafico_barras_contingencia <- function(df, titulo){
g <- ggplot(data = df, aes(x=var, y=cantidad)) + 
  geom_bar(stat = "identity", fill="steelblue") + 
  geom_text(aes(x=var,
                y=cantidad,
                label=paste0(cantidad, " (",porcentaje,")")),
                vjust=-0.4) +
  theme_fivethirtyeight() + 
  theme(axis.text.y=element_blank())
g
}
```

#### ¿Qué tan eficiente fue el estado para respoder?
```{r, fig.height=7, fig.width=5}
tabla_estado <- tabla_contingencia(df, "estado")
p1 <- grafico_barras_contingencia(tabla_estado)
p1 + labs(title="Solicitudes por Estado de Resolución",
          subtitle="Solicitudes de Acceso a la Información Pública en el 2015, en el marco del Decreto 1172/2003.",
          caption="Open Data Cordoba - Fuente: http://datos.gob.ar/")


```

```{r}
tabla_condicion <- tabla_contingencia(df, "condicion_de_respuesta")
p2 <- grafico_barras_contingencia(tabla_condicion)
p2 + theme(axis.text.x = element_text(angle=30, hjust=1, vjust=1)) +
  labs(title="Solicitudes por Condicion de Respuesta",
          subtitle="Solicitudes de Acceso a la Información Pública en el 2015, en el marco del Decreto 1172/2003.",
          caption="Open Data Cordoba - Fuente: http://datos.gob.ar/")
```

```{r}
tabla_plazo <- tabla_contingencia(df, "plazo_en_el_que_se_contesto_la_solicitud")
p3 <- grafico_barras_contingencia(tabla_plazo)
p3 + labs(title="Solicitudes según Plazo de Resolución",
          subtitle="Solicitudes de Acceso a la Información Pública en el 2015, en el marco del Decreto 1172/2003.",
          caption="Open Data Cordoba - Fuente: http://datos.gob.ar/")
```

```{r}
tabla_contingencia(df, "forma_del_pedido")
```

```{r}
test <- df %>% group_by(sector_al_que_se_dirige_la_solicitud, sector_al_que_derivo_el_enlace_dentro_del_organismo) %>% 
  summarise(cant = n())
colnames(test) <- c("N1", "N2", "Value")
test$N1 <- as.character(test$N1)
test$N1 <- ifelse(test$N1 == "", NULL, test$N1)
test <- test[complete.cases(test),]
head(test)
riverplot(test)
```





