---
title: "Caja de Jubilaciones CBA"
author: "Patricio del Boca"
date: "July 26, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
```
Siguiendo la iniciativa de Datos Abiertos, la Caja de Jubilaciones pone a disposición las bases de datos de Jubilaciones y Pensiones, Aportantes y Espacio Illia. En un acto de pura curiosidad dedicamos un poco de tiempo a chusmear qué hay en estos datos:

## Obtencion de Datos:

Con respecto a esta tarea, nos encontramos con varios detalles que pueden ser pulidos para una mejor experiencia en la descarga y utilización de los datos:
 - Gran parte de las herramientas de programación utilizadas para el anaĺisis y uso de los datos públicos tienen el Inglés como idioma por defecto. Esto hace que no se lleven muy bien con caracteres especiales del español como los acentos. Si bien es imposible quitar los acentos de los campos que contengan texto, **es recomendable que la primera fila del archivo (que usualmente nombra el campo) no contenga acentos** para evitar problemas a la hora de leer los archivos.
 - El formato estándar de liberación de datos es **csv** (Comma Separated Values). Por lo que es recomendable que el separador de campos sea una coma (,) y no un (;)
 - Asegurarse que en todas las filas, estén correctamente separados los campos por el delimitador elegido.
 - Por último, proveer de un link visible, único e invariante en el tiempo, permite que se pueda compartir código y que no se necesite de pasos manuales de descarga del archivo a disco. Lo ideal es que se ejecute el programa y se pueda acceder a los datos programáticamente. Lo ideal es que no se necesite entrar manualmente a la página web, seleccionar filtros y hacer click en un botón para descargar el set de datos.
 
Si bien pueden sonar quisquillosas estas recomendaciones, ayudan a la hora de trabajar con los datos abiertos y al momento de incorporarlos programáticamente a otros sistemas. Sobre todo el tercer y cuarto punto, ** se necesitó de trabajo manual no automatizable para descargar el archivo y editar la primera fila para delimitar correctamente los nombres de las columnas, cosa que impide (o hace mucho más compleja) la automatización y reproducibilidad del análisis.**
```{r}
df <- read.csv('_data/Beneficiarios_201606.csv', sep=";",
                 fileEncoding = 'iso-8859-1', row.names = NULL)
levelsRemuneraciones = c("1 a 4000", "4001 a 8000", "8001 a 12000", "12001 a 16000", "16001 a 20000", "20001 a 24000", "24001 a 28000", "28001 a 32000", "Mayor a 32000")
df$Rango.de.remuneraciones <- ordered(df$Rango.de.remuneraciones,
                                        levels=levelsRemuneraciones)
```

## Cantidad de Jubilados por Rango de Remuneracion

```{r pressure, echo=FALSE}
dfRangoCount <- df %>% 
  group_by(Rango.de.remuneraciones) %>% 
  summarise(cantidad = n())

ggplot(dfRangoCount, aes(x=Rango.de.remuneraciones, y=cantidad)) +
  geom_bar(stat="identity", fill="steelblue") +
  ggtitle("Cantidad de Jubilaciones por Remuneración \n (Prov. Córdoba - Junio 2016)") +
  geom_text(data=dfRangoCount,
            aes(x=Rango.de.remuneraciones,
                y=cantidad,
                label=cantidad),
            vjust=-0.25) +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 30, hjust = 1.1, vjust = 1.8),
        axis.text.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_blank()
        )
```

## Jubilaciones de Privilegio
```{r}
dfPriv <- df %>% 
  filter(Rango.de.remuneraciones == "Mayor a 32000") %>% 
  group_by(Agrupamiento.de.sectores) %>% 
  summarise(cantidad = n()) %>% 
  arrange(desc(cantidad))

ggplot(dfPriv, aes(x=reorder(Agrupamiento.de.sectores, cantidad), y=cantidad)) + 
  geom_bar(stat="identity", fill="steelblue") + 
  coord_flip() + 
  ggtitle("Quiénes cobran las 12015 jubilaciones más altas? \n (Jubilaciones > $32000 - Prov Córdoba - Junio 2016)") +
  geom_text(data=dfPriv,
            aes(x=Agrupamiento.de.sectores,
                y=cantidad,
                label=cantidad),
            hjust=-0.15) +
  theme_minimal() + xlab(NULL) + ylab(NULL) + 
  theme(axis.text.x = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title.y = element_blank(),
        axis.title.x = element_blank())
```

